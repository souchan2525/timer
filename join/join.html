<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dotenv@16.4.5/dist/dotenv.min.js"></script>
    <script>
      // Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®åˆæœŸåŒ–
      const supabaseUrl = process.env.baseurl; // ç½®ãæ›ãˆã¦ãã ã•ã„
      const supabaseKey = process.env.basekey; // ç½®ãæ›ãˆã¦ãã ã•ã„
      const supabase = supabase.createClient(supabaseUrl, supabaseKey);
    </script>
  </head>
  <body>
    <main class="container" style="display: flex; flex-direction: column; justify-content: center; min-height: 80vh;">
      <article>
        <header>
          <strong>ğŸ” ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™</strong>
        </header>
        <p>ã€Œ<span id="server-name">èª­ã¿è¾¼ã¿ä¸­...</span>ã€ã¸å…¥å®¤ã™ã‚‹ã«ã¯åˆè¨€è‘‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
        
        <form id="login-form">
          <input type="password" id="pass" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" required>
          <button type="submit">ã‚µãƒ¼ãƒãƒ¼ã¸å…¥ã‚‹</button>
        </form>
        
        <footer id="msg" style="color: var(--pico-error-color);"></footer>
      </article>
    </main>

    <script>
      // URLã®æœ€å¾Œï¼ˆsouchan-serverï¼‰ã‚’å–å¾—
      const slug = window.location.pathname.split('/').pop();
      document.getElementById('server-name').innerText = slug;

      document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const pass = document.getElementById('pass').value;

        // Supabaseã§ç…§åˆï¼ˆBotãŒä¿å­˜ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’æ¢ã™ï¼‰
        const { data, error } = await supabase
          .from('custom_invites')
          .select('invite_url')
          .eq('slug', slug)
          .eq('password', pass)
          .single();

        if (data) {
          window.location.href = data.invite_url; // æ‹›å¾…ãƒªãƒ³ã‚¯ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
        } else {
          document.getElementById('msg').innerText = "âŒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚";
        }
      });
    </script>
  </body>
</html>